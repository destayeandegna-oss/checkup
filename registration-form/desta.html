<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biometric Attendance System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4A49C5',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes scan {
            0%, 100% { transform: translateY(-100%); }
            50% { transform: translateY(200%); }
        }
        .scan-line {
            animation: scan 2s ease-in-out infinite;
        }
        .fingerprint-scanner {
            position: relative;
            overflow: hidden;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.7; }
            100% { transform: scale(0.95); opacity: 1; }
        }
        .pulse-ring {
            animation: pulse-ring 2s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <!-- Main Container -->
    <div class="min-h-screen flex flex-col md:flex-row">
        <!-- Sidebar -->
        <aside id="sidebar" class="bg-gray-100 dark:bg-gray-800 w-full md:w-64 border-r border-gray-200 dark:border-gray-700">
            <div class="p-6">
                <div class="flex items-center space-x-3 mb-8">
                    <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                        <i class="fas fa-fingerprint text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">BioAttend</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Smart Attendance</p>
                    </div>
                </div>

                <nav class="space-y-2">
                    <button onclick="showView('dashboard')" class="nav-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-chart-line w-5"></i>
                        <span>Dashboard</span>
                    </button>
                    <button onclick="showView('attendance')" class="nav-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-clock w-5"></i>
                        <span>Mark Attendance</span>
                    </button>
                    <button onclick="showView('employees')" class="nav-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-users w-5"></i>
                        <span>Employees</span>
                    </button>
                    <button onclick="showView('records')" class="nav-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-calendar-alt w-5"></i>
                        <span>Attendance Records</span>
                    </button>
                    <button onclick="showView('reports')" class="nav-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-file-alt w-5"></i>
                        <span>Reports</span>
                    </button>
                </nav>
            </div>

            <div class="absolute bottom-0 left-0 right-0 p-6 border-t border-gray-200 dark:border-gray-700 hidden md:block">
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-600 dark:text-gray-400">Theme</span>
                    <button onclick="toggleTheme()" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i id="theme-icon" class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-auto">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view p-4 md:p-8">
                <div class="mb-6">
                    <h2 class="text-2xl md:text-3xl font-bold mb-2">Dashboard</h2>
                    <p class="text-gray-600 dark:text-gray-400">Overview of attendance statistics</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-8">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-users text-2xl"></i>
                            </div>
                        </div>
                        <p class="text-sm opacity-90 mb-1">Total Employees</p>
                        <h3 id="total-employees" class="text-3xl font-bold">0</h3>
                    </div>

                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check-circle text-2xl"></i>
                            </div>
                        </div>
                        <p class="text-sm opacity-90 mb-1">Present Today</p>
                        <h3 id="present-today" class="text-3xl font-bold">0</h3>
                    </div>

                    <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-times-circle text-2xl"></i>
                            </div>
                        </div>
                        <p class="text-sm opacity-90 mb-1">Absent Today</p>
                        <h3 id="absent-today" class="text-3xl font-bold">0</h3>
                    </div>

                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-percentage text-2xl"></i>
                            </div>
                        </div>
                        <p class="text-sm opacity-90 mb-1">Attendance Rate</p>
                        <h3 id="attendance-rate" class="text-3xl font-bold">0%</h3>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4">Recent Activity</h3>
                    <div id="recent-activity" class="space-y-3">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-8">No recent activity</p>
                    </div>
                </div>
            </div>

            <!-- Attendance Marking View -->
            <div id="attendance-view" class="view hidden p-4 md:p-8">
                <div class="mb-6">
                    <h2 class="text-2xl md:text-3xl font-bold mb-2">Mark Attendance</h2>
                    <p class="text-gray-600 dark:text-gray-400">Scan biometric to mark attendance</p>
                </div>

                <div class="max-w-2xl mx-auto">
                    <!-- Biometric Scanner -->
                    <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-8">
                        <div class="text-center mb-6">
                            <div class="inline-flex items-center space-x-2 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 px-4 py-2 rounded-full text-base mb-4">
                                <i class="fas fa-info-circle"></i>
                                <span id="scanner-status">Ready to scan</span>
                            </div>
                        </div>

                        <!-- Fingerprint Scanner Simulation -->
                        <div class="fingerprint-scanner mx-auto w-64 h-64 bg-gradient-to-br from-primary to-primary-dark rounded-full flex items-center justify-center relative mb-6 cursor-pointer pulse-ring" onclick="simulateBiometricScan()">
                            <div class="w-56 h-56 bg-white dark:bg-gray-900 rounded-full flex items-center justify-center">
                                <i class="fas fa-fingerprint text-8xl text-primary"></i>
                            </div>
                            <div id="scan-line" class="hidden absolute w-full h-1 bg-green-400 opacity-70 scan-line"></div>
                        </div>

                        <div class="text-center">
                            <p class="text-gray-600 dark:text-gray-400 mb-4">Click the fingerprint to simulate biometric scan</p>
                            <button onclick="simulateBiometricScan()" class="bg-primary hover:bg-primary-dark text-white px-8 py-3 rounded-lg font-semibold transition-colors">
                                <i class="fas fa-fingerprint mr-2"></i>
                                Scan Now
                            </button>
                        </div>
                    </div>

                    <!-- Manual Check-in Option -->
                    <div class="mt-6 bg-gray-50 dark:bg-gray-800 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">Manual Entry</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Employee ID</label>
                                <input type="text" id="manual-employee-id" placeholder="Enter employee ID" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="manualCheckIn()" class="flex-1 bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                                    <i class="fas fa-sign-in-alt mr-2"></i>
                                    Check In
                                </button>
                                <button onclick="manualCheckOut()" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                                    <i class="fas fa-sign-out-alt mr-2"></i>
                                    Check Out
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employees View -->
            <div id="employees-view" class="view hidden p-4 md:p-8">
                <div class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div>
                        <h2 class="text-2xl md:text-3xl font-bold mb-2">Employees</h2>
                        <p class="text-gray-600 dark:text-gray-400">Manage employee records</p>
                    </div>
                    <button onclick="showAddEmployeeModal()" class="bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                        <i class="fas fa-plus mr-2"></i>
                        Add Employee
                    </button>
                </div>

                <!-- Search and Filter -->
                <div class="mb-6 bg-gray-50 dark:bg-gray-800 rounded-xl p-4">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <input type="text" id="employee-search" placeholder="Search employees..." onkeyup="filterEmployees()" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                        </div>
                        <select id="department-filter" onchange="filterEmployees()" class="px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                            <option value="">All Departments</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Sales">Sales</option>
                            <option value="Marketing">Marketing</option>
                            <option value="HR">HR</option>
                            <option value="Finance">Finance</option>
                        </select>
                    </div>
                </div>

                <!-- Employees Table -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-200 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-4 text-left text-sm font-semibold">ID</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold">Name</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold hidden md:table-cell">Department</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold hidden md:table-cell">Email</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold">Status</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="employees-table-body" class="divide-y divide-gray-200 dark:divide-gray-700">
                                <tr>
                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                        No employees found. Add your first employee!
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Attendance Records View -->
            <div id="records-view" class="view hidden p-4 md:p-8">
                <div class="mb-6">
                    <h2 class="text-2xl md:text-3xl font-bold mb-2">Attendance Records</h2>
                    <p class="text-gray-600 dark:text-gray-400">View and manage attendance history</p>
                </div>

                <!-- Date Filter -->
                <div class="mb-6 bg-gray-50 dark:bg-gray-800 rounded-xl p-4">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <label class="block text-sm font-medium mb-2">From Date</label>
                            <input type="date" id="from-date" onchange="filterRecords()" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                        </div>
                        <div class="flex-1">
                            <label class="block text-sm font-medium mb-2">To Date</label>
                            <input type="date" id="to-date" onchange="filterRecords()" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                        </div>
                        <div class="flex-1">
                            <label class="block text-sm font-medium mb-2">Employee</label>
                            <select id="employee-filter" onchange="filterRecords()" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                                <option value="">All Employees</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Records Table -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-200 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-4 text-left text-sm font-semibold">Date</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold">Employee</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold">Check In</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold">Check Out</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold hidden md:table-cell">Duration</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold">Status</th>
                                </tr>
                            </thead>
                            <tbody id="records-table-body" class="divide-y divide-gray-200 dark:divide-gray-700">
                                <tr>
                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                        No attendance records found
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports View -->
            <div id="reports-view" class="view hidden p-4 md:p-8">
                <div class="mb-6">
                    <h2 class="text-2xl md:text-3xl font-bold mb-2">Reports</h2>
                    <p class="text-gray-600 dark:text-gray-400">Generate and export attendance reports</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Monthly Report -->
                    <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">Monthly Report</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Select Month</label>
                                <input type="month" id="monthly-report-month" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                            </div>
                            <button onclick="generateMonthlyReport()" class="w-full bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                                <i class="fas fa-file-download mr-2"></i>
                                Generate Report
                            </button>
                        </div>
                    </div>

                    <!-- Employee Report -->
                    <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">Employee Report</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Select Employee</label>
                                <select id="employee-report-select" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                                    <option value="">Select an employee</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">From</label>
                                    <input type="date" id="employee-report-from" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">To</label>
                                    <input type="date" id="employee-report-to" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                                </div>
                            </div>
                            <button onclick="generateEmployeeReport()" class="w-full bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                                <i class="fas fa-file-download mr-2"></i>
                                Generate Report
                            </button>
                        </div>
                    </div>

                    <!-- Department Report -->
                    <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">Department Report</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Select Department</label>
                                <select id="department-report-select" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                                    <option value="">Select a department</option>
                                    <option value="Engineering">Engineering</option>
                                    <option value="Sales">Sales</option>
                                    <option value="Marketing">Marketing</option>
                                    <option value="HR">HR</option>
                                    <option value="Finance">Finance</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Select Month</label>
                                <input type="month" id="department-report-month" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                            </div>
                            <button onclick="generateDepartmentReport()" class="w-full bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                                <i class="fas fa-file-download mr-2"></i>
                                Generate Report
                            </button>
                        </div>
                    </div>

                    <!-- Export Data -->
                    <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">Export All Data</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">Export complete attendance database to CSV format</p>
                        <button onclick="exportAllData()" class="w-full bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                            <i class="fas fa-download mr-2"></i>
                            Export to CSV
                        </button>
                    </div>
                </div>

                <!-- Report Preview -->
                <div id="report-preview" class="hidden mt-6 bg-gray-50 dark:bg-gray-800 rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold">Report Preview</h3>
                        <button onclick="closeReportPreview()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="report-content" class="overflow-x-auto"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Employee Modal -->
    <div id="add-employee-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl max-w-md w-full p-6 max-h-screen overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold">Add Employee</h3>
                <button onclick="closeAddEmployeeModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <form onsubmit="addEmployee(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Employee ID *</label>
                    <input type="text" id="new-employee-id" required class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Full Name *</label>
                    <input type="text" id="new-employee-name" required class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Email *</label>
                    <input type="email" id="new-employee-email" required class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Department *</label>
                    <select id="new-employee-department" required class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                        <option value="">Select department</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Sales">Sales</option>
                        <option value="Marketing">Marketing</option>
                        <option value="HR">HR</option>
                        <option value="Finance">Finance</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Phone</label>
                    <input type="tel" id="new-employee-phone" class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Biometric ID (Simulated)</label>
                    <input type="text" id="new-employee-biometric" placeholder="Auto-generated" readonly class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg text-base cursor-not-allowed">
                </div>
                <div class="flex space-x-3 pt-4">
                    <button type="button" onclick="closeAddEmployeeModal()" class="flex-1 px-6 py-3 border border-gray-300 dark:border-gray-600 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                        Add Employee
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div id="alert-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl max-w-sm w-full p-6">
            <div class="flex items-center justify-center mb-4">
                <div id="alert-icon" class="w-12 h-12 rounded-full flex items-center justify-center">
                    <i class="fas fa-info-circle text-2xl"></i>
                </div>
            </div>
            <p id="alert-message" class="text-center mb-6 text-base"></p>
            <button onclick="closeAlert()" class="w-full bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                OK
            </button>
        </div>
    </div>

    <script>
        // Data Storage (In-memory since localStorage not available in iframe)
        let employees = [];
        let attendanceRecords = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            showView('dashboard');
            updateDashboard();
            renderEmployees();
            renderRecords();
            populateEmployeeFilters();
            setDefaultDates();
            loadSampleData();
        });

        // Theme Management
        function initializeTheme() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                document.getElementById('theme-icon').className = 'fas fa-sun';
            }
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                    document.getElementById('theme-icon').className = 'fas fa-sun';
                } else {
                    document.documentElement.classList.remove('dark');
                    document.getElementById('theme-icon').className = 'fas fa-moon';
                }
            });
        }

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            const icon = document.getElementById('theme-icon');
            icon.className = document.documentElement.classList.contains('dark') ? 'fas fa-sun' : 'fas fa-moon';
        }

        // View Management
        function showView(viewName) {
            document.querySelectorAll('.view').forEach(view => view.classList.add('hidden'));
            document.getElementById(`${viewName}-view`).classList.remove('hidden');

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
            });
            event.target.closest('.nav-btn').classList.add('bg-primary', 'text-white');

            if (viewName === 'dashboard') updateDashboard();
            if (viewName === 'records') renderRecords();
        }

        // Alert Modal
        function showAlert(message, type = 'info') {
            const modal = document.getElementById('alert-modal');
            const alertMessage = document.getElementById('alert-message');
            const alertIcon = document.getElementById('alert-icon');

            alertMessage.textContent = message;

            const iconMap = {
                success: { icon: 'fa-check-circle', color: 'bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400' },
                error: { icon: 'fa-exclamation-circle', color: 'bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400' },
                warning: { icon: 'fa-exclamation-triangle', color: 'bg-yellow-100 dark:bg-yellow-900 text-yellow-600 dark:text-yellow-400' },
                info: { icon: 'fa-info-circle', color: 'bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400' }
            };

            const config = iconMap[type] || iconMap.info;
            alertIcon.className = `w-12 h-12 rounded-full flex items-center justify-center ${config.color}`;
            alertIcon.querySelector('i').className = `fas ${config.icon} text-2xl`;

            modal.classList.remove('hidden');
        }

        function closeAlert() {
            document.getElementById('alert-modal').classList.add('hidden');
        }

        // Employee Management
        function showAddEmployeeModal() {
            document.getElementById('new-employee-biometric').value = 'BIO-' + Date.now();
            document.getElementById('add-employee-modal').classList.remove('hidden');
        }

        function closeAddEmployeeModal() {
            document.getElementById('add-employee-modal').classList.add('hidden');
            document.querySelector('#add-employee-modal form').reset();
        }

        function addEmployee(event) {
            event.preventDefault();

            const employeeId = document.getElementById('new-employee-id').value;

            if (employees.find(e => e.id === employeeId)) {
                showAlert('Employee ID already exists!', 'error');
                return;
            }

            const employee = {
                id: employeeId,
                name: document.getElementById('new-employee-name').value,
                email: document.getElementById('new-employee-email').value,
                department: document.getElementById('new-employee-department').value,
                phone: document.getElementById('new-employee-phone').value,
                biometricId: document.getElementById('new-employee-biometric').value,
                status: 'active',
                createdAt: new Date().toISOString()
            };

            employees.push(employee);

            closeAddEmployeeModal();
            renderEmployees();
            updateDashboard();
            populateEmployeeFilters();
            showAlert('Employee added successfully!', 'success');
        }

        function deleteEmployee(employeeId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-xl max-w-sm w-full p-6">
                    <p class="text-center mb-6 text-base">Are you sure you want to delete this employee?</p>
                    <div class="flex space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 px-6 py-3 border border-gray-300 dark:border-gray-600 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Cancel</button>
                        <button onclick="confirmDeleteEmployee('${employeeId}'); this.closest('.fixed').remove()" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">Delete</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmDeleteEmployee(employeeId) {
            employees = employees.filter(e => e.id !== employeeId);
            renderEmployees();
            updateDashboard();
            populateEmployeeFilters();
            showAlert('Employee deleted successfully!', 'success');
        }

        function renderEmployees() {
            const tbody = document.getElementById('employees-table-body');

            if (employees.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                            No employees found. Add your first employee!
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = employees.map(emp => `
                <tr class="hover:bg-gray-100 dark:hover:bg-gray-700">
                    <td class="px-6 py-4">${emp.id}</td>
                    <td class="px-6 py-4 font-medium">${emp.name}</td>
                    <td class="px-6 py-4 hidden md:table-cell">${emp.department}</td>
                    <td class="px-6 py-4 hidden md:table-cell">${emp.email}</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 rounded-full text-sm ${emp.status === 'active' ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300' : 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300'}">
                            ${emp.status}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="deleteEmployee('${emp.id}')" class="text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function filterEmployees() {
            const searchTerm = document.getElementById('employee-search').value.toLowerCase();
            const departmentFilter = document.getElementById('department-filter').value;

            const filtered = employees.filter(emp => {
                const matchesSearch = emp.name.toLowerCase().includes(searchTerm) ||
                                    emp.id.toLowerCase().includes(searchTerm) ||
                                    emp.email.toLowerCase().includes(searchTerm);
                const matchesDepartment = !departmentFilter || emp.department === departmentFilter;
                return matchesSearch && matchesDepartment;
            });

            const tbody = document.getElementById('employees-table-body');

            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                            No employees match your filters
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = filtered.map(emp => `
                <tr class="hover:bg-gray-100 dark:hover:bg-gray-700">
                    <td class="px-6 py-4">${emp.id}</td>
                    <td class="px-6 py-4 font-medium">${emp.name}</td>
                    <td class="px-6 py-4 hidden md:table-cell">${emp.department}</td>
                    <td class="px-6 py-4 hidden md:table-cell">${emp.email}</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 rounded-full text-sm ${emp.status === 'active' ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300' : 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300'}">
                            ${emp.status}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="deleteEmployee('${emp.id}')" class="text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Attendance Management
        function simulateBiometricScan() {
            if (employees.length === 0) {
                showAlert('No employees registered. Please add employees first.', 'warning');
                return;
            }

            const status = document.getElementById('scanner-status');
            const scanLine = document.getElementById('scan-line');

            status.textContent = 'Scanning...';
            status.className = 'inline-flex items-center space-x-2 bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300 px-4 py-2 rounded-full text-base mb-4';
            scanLine.classList.remove('hidden');

            setTimeout(() => {
                const randomEmployee = employees[Math.floor(Math.random() * employees.length)];
                const now = new Date();
                const today = now.toISOString().split('T')[0];

                const existingRecord = attendanceRecords.find(r =>
                    r.employeeId === randomEmployee.id && r.date === today
                );

                if (existingRecord && !existingRecord.checkOut) {
                    existingRecord.checkOut = now.toISOString();
                    status.textContent = `Check-out successful: ${randomEmployee.name}`;
                    status.className = 'inline-flex items-center space-x-2 bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 px-4 py-2 rounded-full text-base mb-4';
                    showAlert(`${randomEmployee.name} checked out successfully!`, 'success');
                } else if (existingRecord && existingRecord.checkOut) {
                    status.textContent = 'Already checked out today';
                    status.className = 'inline-flex items-center space-x-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 px-4 py-2 rounded-full text-base mb-4';
                    showAlert('You have already checked out today!', 'warning');
                } else {
                    const record = {
                        id: Date.now().toString(),
                        employeeId: randomEmployee.id,
                        employeeName: randomEmployee.name,
                        date: today,
                        checkIn: now.toISOString(),
                        checkOut: null,
                        status: 'present'
                    };
                    attendanceRecords.push(record);
                    status.textContent = `Check-in successful: ${randomEmployee.name}`;
                    status.className = 'inline-flex items-center space-x-2 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 px-4 py-2 rounded-full text-base mb-4';
                    showAlert(`${randomEmployee.name} checked in successfully!`, 'success');
                }

                updateDashboard();
                renderRecords();

                scanLine.classList.add('hidden');
                setTimeout(() => {
                    status.textContent = 'Ready to scan';
                    status.className = 'inline-flex items-center space-x-2 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 px-4 py-2 rounded-full text-base mb-4';
                }, 3000);
            }, 2000);
        }

        function manualCheckIn() {
            const employeeId = document.getElementById('manual-employee-id').value.trim();
            if (!employeeId) {
                showAlert('Please enter an employee ID', 'warning');
                return;
            }

            const employee = employees.find(e => e.id === employeeId);
            if (!employee) {
                showAlert('Employee not found!', 'error');
                return;
            }

            const now = new Date();
            const today = now.toISOString().split('T')[0];

            const existingRecord = attendanceRecords.find(r =>
                r.employeeId === employeeId && r.date === today
            );

            if (existingRecord) {
                showAlert('Employee already checked in today!', 'warning');
                return;
            }

            const record = {
                id: Date.now().toString(),
                employeeId: employee.id,
                employeeName: employee.name,
                date: today,
                checkIn: now.toISOString(),
                checkOut: null,
                status: 'present'
            };

            attendanceRecords.push(record);

            document.getElementById('manual-employee-id').value = '';
            updateDashboard();
            renderRecords();
            showAlert(`${employee.name} checked in successfully!`, 'success');
        }

        function manualCheckOut() {
            const employeeId = document.getElementById('manual-employee-id').value.trim();
            if (!employeeId) {
                showAlert('Please enter an employee ID', 'warning');
                return;
            }

            const employee = employees.find(e => e.id === employeeId);
            if (!employee) {
                showAlert('Employee not found!', 'error');
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const record = attendanceRecords.find(r =>
                r.employeeId === employeeId && r.date === today
            );

            if (!record) {
                showAlert('No check-in record found for today!', 'error');
                return;
            }

            if (record.checkOut) {
                showAlert('Employee already checked out!', 'warning');
                return;
            }

            record.checkOut = new Date().toISOString();

            document.getElementById('manual-employee-id').value = '';
            updateDashboard();
            renderRecords();
            showAlert(`${employee.name} checked out successfully!`, 'success');
        }

        // Dashboard
        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const todayRecords = attendanceRecords.filter(r => r.date === today);
            const presentCount = todayRecords.length;
            const absentCount = employees.length - presentCount;
            const attendanceRate = employees.length > 0 ?
                Math.round((presentCount / employees.length) * 100) : 0;

            document.getElementById('total-employees').textContent = employees.length;
            document.getElementById('present-today').textContent = presentCount;
            document.getElementById('absent-today').textContent = absentCount;
            document.getElementById('attendance-rate').textContent = attendanceRate + '%';

            // Recent Activity
            const recentActivity = document.getElementById('recent-activity');
            const recentRecords = attendanceRecords.slice(-10).reverse();

            if (recentRecords.length === 0) {
                recentActivity.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No recent activity</p>';
            } else {
                recentActivity.innerHTML = recentRecords.map(record => {
                    const checkInTime = new Date(record.checkIn).toLocaleTimeString();
                    const checkOutTime = record.checkOut ? new Date(record.checkOut).toLocaleTimeString() : 'N/A';

                    return `
                        <div class="flex items-center justify-between p-3 bg-white dark:bg-gray-700 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white font-semibold">
                                    ${record.employeeName.charAt(0)}
                                </div>
                                <div>
                                    <p class="font-medium">${record.employeeName}</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">${record.date}</p>
                                </div>
                            </div>
                            <div class="text-right text-sm">
                                <p class="text-green-600 dark:text-green-400">In: ${checkInTime}</p>
                                ${record.checkOut ? `<p class="text-orange-600 dark:text-orange-400">Out: ${checkOutTime}</p>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Records
        function renderRecords() {
            const tbody = document.getElementById('records-table-body');

            if (attendanceRecords.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                            No attendance records found
                        </td>
                    </tr>
                `;
                return;
            }

            const sorted = [...attendanceRecords].sort((a, b) =>
                new Date(b.checkIn) - new Date(a.checkIn)
            );

            tbody.innerHTML = sorted.map(record => {
                const checkIn = new Date(record.checkIn);
                const checkOut = record.checkOut ? new Date(record.checkOut) : null;
                const duration = checkOut ?
                    Math.round((checkOut - checkIn) / (1000 * 60 * 60) * 10) / 10 : 'N/A';

                return `
                    <tr class="hover:bg-gray-100 dark:hover:bg-gray-700">
                        <td class="px-6 py-4">${record.date}</td>
                        <td class="px-6 py-4 font-medium">${record.employeeName}</td>
                        <td class="px-6 py-4">${checkIn.toLocaleTimeString()}</td>
                        <td class="px-6 py-4">${checkOut ? checkOut.toLocaleTimeString() : '-'}</td>
                        <td class="px-6 py-4 hidden md:table-cell">${duration !== 'N/A' ? duration + 'h' : '-'}</td>
                        <td class="px-6 py-4">
                            <span class="px-3 py-1 rounded-full text-sm ${checkOut ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300' : 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300'}">
                                ${checkOut ? 'Completed' : 'Active'}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterRecords() {
            const fromDate = document.getElementById('from-date').value;
            const toDate = document.getElementById('to-date').value;
            const employeeFilter = document.getElementById('employee-filter').value;

            let filtered = attendanceRecords;

            if (fromDate) {
                filtered = filtered.filter(r => r.date >= fromDate);
            }
            if (toDate) {
                filtered = filtered.filter(r => r.date <= toDate);
            }
            if (employeeFilter) {
                filtered = filtered.filter(r => r.employeeId === employeeFilter);
            }

            const tbody = document.getElementById('records-table-body');

            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                            No records match your filters
                        </td>
                    </tr>
                `;
                return;
            }

            const sorted = [...filtered].sort((a, b) =>
                new Date(b.checkIn) - new Date(a.checkIn)
            );

            tbody.innerHTML = sorted.map(record => {
                const checkIn = new Date(record.checkIn);
                const checkOut = record.checkOut ? new Date(record.checkOut) : null;
                const duration = checkOut ?
                    Math.round((checkOut - checkIn) / (1000 * 60 * 60) * 10) / 10 : 'N/A';

                return `
                    <tr class="hover:bg-gray-100 dark:hover:bg-gray-700">
                        <td class="px-6 py-4">${record.date}</td>
                        <td class="px-6 py-4 font-medium">${record.employeeName}</td>
                        <td class="px-6 py-4">${checkIn.toLocaleTimeString()}</td>
                        <td class="px-6 py-4">${checkOut ? checkOut.toLocaleTimeString() : '-'}</td>
                        <td class="px-6 py-4 hidden md:table-cell">${duration !== 'N/A' ? duration + 'h' : '-'}</td>
                        <td class="px-6 py-4">
                            <span class="px-3 py-1 rounded-full text-sm ${checkOut ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300' : 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300'}">
                                ${checkOut ? 'Completed' : 'Active'}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Reports
        function generateMonthlyReport() {
            const month = document.getElementById('monthly-report-month').value;
            if (!month) {
                showAlert('Please select a month', 'warning');
                return;
            }

            const filtered = attendanceRecords.filter(r => r.date.startsWith(month));

            if (filtered.length === 0) {
                showAlert('No records found for selected month', 'warning');
                return;
            }

            const report = generateReportHTML(filtered, `Monthly Report - ${month}`);
            showReportPreview(report);
        }

        function generateEmployeeReport() {
            const employeeId = document.getElementById('employee-report-select').value;
            const fromDate = document.getElementById('employee-report-from').value;
            const toDate = document.getElementById('employee-report-to').value;

            if (!employeeId) {
                showAlert('Please select an employee', 'warning');
                return;
            }

            let filtered = attendanceRecords.filter(r => r.employeeId === employeeId);

            if (fromDate) filtered = filtered.filter(r => r.date >= fromDate);
            if (toDate) filtered = filtered.filter(r => r.date <= toDate);

            if (filtered.length === 0) {
                showAlert('No records found for selected criteria', 'warning');
                return;
            }

            const employee = employees.find(e => e.id === employeeId);
            const report = generateReportHTML(filtered, `Employee Report - ${employee.name}`);
            showReportPreview(report);
        }

        function generateDepartmentReport() {
            const department = document.getElementById('department-report-select').value;
            const month = document.getElementById('department-report-month').value;

            if (!department) {
                showAlert('Please select a department', 'warning');
                return;
            }

            if (!month) {
                showAlert('Please select a month', 'warning');
                return;
            }

            const deptEmployees = employees.filter(e => e.department === department);
            const deptEmployeeIds = deptEmployees.map(e => e.id);

            const filtered = attendanceRecords.filter(r =>
                deptEmployeeIds.includes(r.employeeId) && r.date.startsWith(month)
            );

            if (filtered.length === 0) {
                showAlert('No records found for selected criteria', 'warning');
                return;
            }

            const report = generateReportHTML(filtered, `Department Report - ${department} (${month})`);
            showReportPreview(report);
        }

        function generateReportHTML(records, title) {
            const totalRecords = records.length;
            const completedRecords = records.filter(r => r.checkOut).length;

            let totalHours = 0;
            records.forEach(r => {
                if (r.checkOut) {
                    const duration = (new Date(r.checkOut) - new Date(r.checkIn)) / (1000 * 60 * 60);
                    totalHours += duration;
                }
            });
            const avgHours = completedRecords > 0 ? (totalHours / completedRecords).toFixed(2) : 0;

            return `
                <div class="mb-6">
                    <h4 class="text-2xl font-bold mb-4">${title}</h4>
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                            <p class="text-sm text-gray-500 dark:text-gray-400">Total Records</p>
                            <p class="text-2xl font-bold">${totalRecords}</p>
                        </div>
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                            <p class="text-sm text-gray-500 dark:text-gray-400">Completed</p>
                            <p class="text-2xl font-bold">${completedRecords}</p>
                        </div>
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                            <p class="text-sm text-gray-500 dark:text-gray-400">Avg Hours</p>
                            <p class="text-2xl font-bold">${avgHours}h</p>
                        </div>
                    </div>
                    <table class="w-full">
                        <thead class="bg-gray-200 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-2 text-left">Date</th>
                                <th class="px-4 py-2 text-left">Employee</th>
                                <th class="px-4 py-2 text-left">Check In</th>
                                <th class="px-4 py-2 text-left">Check Out</th>
                                <th class="px-4 py-2 text-left">Hours</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${records.map(r => {
                                const checkIn = new Date(r.checkIn);
                                const checkOut = r.checkOut ? new Date(r.checkOut) : null;
                                const hours = checkOut ?
                                    ((checkOut - checkIn) / (1000 * 60 * 60)).toFixed(2) : '-';

                                return `
                                    <tr class="border-b border-gray-200 dark:border-gray-700">
                                        <td class="px-4 py-2">${r.date}</td>
                                        <td class="px-4 py-2">${r.employeeName}</td>
                                        <td class="px-4 py-2">${checkIn.toLocaleTimeString()}</td>
                                        <td class="px-4 py-2">${checkOut ? checkOut.toLocaleTimeString() : '-'}</td>
                                        <td class="px-4 py-2">${hours !== '-' ? hours + 'h' : '-'}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function showReportPreview(html) {
            document.getElementById('report-content').innerHTML = html;
            document.getElementById('report-preview').classList.remove('hidden');
        }

        function closeReportPreview() {
            document.getElementById('report-preview').classList.add('hidden');
        }

        function exportAllData() {
            if (attendanceRecords.length === 0) {
                showAlert('No data to export', 'warning');
                return;
            }

            const csv = [
                ['Date', 'Employee ID', 'Employee Name', 'Check In', 'Check Out', 'Duration (hours)'],
                ...attendanceRecords.map(r => {
                    const checkIn = new Date(r.checkIn);
                    const checkOut = r.checkOut ? new Date(r.checkOut) : null;
                    const duration = checkOut ?
                        ((checkOut - checkIn) / (1000 * 60 * 60)).toFixed(2) : '';

                    return [
                        r.date,
                        r.employeeId,
                        r.employeeName,
                        checkIn.toLocaleString(),
                        checkOut ? checkOut.toLocaleString() : '',
                        duration
                    ];
                })
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `attendance-data-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);

            showAlert('Data exported successfully!', 'success');
        }

        // Utility Functions
        function populateEmployeeFilters() {
            const employeeFilter = document.getElementById('employee-filter');
            const employeeReportSelect = document.getElementById('employee-report-select');

            const options = employees.map(emp =>
                `<option value="${emp.id}">${emp.name} (${emp.id})</option>`
            ).join('');

            employeeFilter.innerHTML = '<option value="">All Employees</option>' + options;
            employeeReportSelect.innerHTML = '<option value="">Select an employee</option>' + options;
        }

        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            const firstDay = new Date(new Date().getFullYear(), new Date().getMonth(), 1)
                .toISOString().split('T')[0];

            document.getElementById('from-date').value = firstDay;
            document.getElementById('to-date').value = today;
            document.getElementById('employee-report-from').value = firstDay;
            document.getElementById('employee-report-to').value = today;

            const currentMonth = new Date().toISOString().slice(0, 7);
            document.getElementById('monthly-report-month').value = currentMonth;
            document.getElementById('department-report-month').value = currentMonth;
        }

        // Load Sample Data for demonstration
        function loadSampleData() {
            // Add sample employees
            const sampleEmployees = [
                {
                    id: 'EMP001',
                    name: 'John Smith',
                    email: 'john.smith@company.com',
                    department: 'Engineering',
                    phone: '+1-555-0101',
                    biometricId: 'BIO-1001',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'EMP002',
                    name: 'Sarah Johnson',
                    email: 'sarah.j@company.com',
                    department: 'Marketing',
                    phone: '+1-555-0102',
                    biometricId: 'BIO-1002',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'EMP003',
                    name: 'Michael Chen',
                    email: 'michael.c@company.com',
                    department: 'Engineering',
                    phone: '+1-555-0103',
                    biometricId: 'BIO-1003',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'EMP004',
                    name: 'Emily Davis',
                    email: 'emily.d@company.com',
                    department: 'HR',
                    phone: '+1-555-0104',
                    biometricId: 'BIO-1004',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'EMP005',
                    name: 'Robert Wilson',
                    email: 'robert.w@company.com',
                    department: 'Sales',
                    phone: '+1-555-0105',
                    biometricId: 'BIO-1005',
                    status: 'active',
                    createdAt: new Date().toISOString()
                }
            ];

            employees.push(...sampleEmployees);

            // Add sample attendance records for today
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];

            sampleEmployees.forEach((emp, index) => {
                if (index < 3) { // First 3 employees have checked in
                    const checkInTime = new Date(today);
                    checkInTime.setHours(9, index * 15, 0, 0);

                    const record = {
                        id: `ATT-${Date.now()}-${index}`,
                        employeeId: emp.id,
                        employeeName: emp.name,
                        date: todayStr,
                        checkIn: checkInTime.toISOString(),
                        checkOut: index === 0 ? new Date(checkInTime.getTime() + 8 * 60 * 60 * 1000).toISOString() : null,
                        status: 'present'
                    };
                    attendanceRecords.push(record);
                }
            });

            // Add some historical records
            for (let i = 1; i <= 5; i++) {
                const pastDate = new Date(today);
                pastDate.setDate(today.getDate() - i);
                const pastDateStr = pastDate.toISOString().split('T')[0];

                sampleEmployees.forEach((emp, empIndex) => {
                    if (Math.random() > 0.2) { // 80% attendance rate
                        const checkIn = new Date(pastDate);
                        checkIn.setHours(9, Math.floor(Math.random() * 30), 0, 0);

                        const checkOut = new Date(checkIn);
                        checkOut.setHours(17, Math.floor(Math.random() * 60), 0, 0);

                        const record = {
                            id: `ATT-PAST-${i}-${empIndex}`,
                            employeeId: emp.id,
                            employeeName: emp.name,
                            date: pastDateStr,
                            checkIn: checkIn.toISOString(),
                            checkOut: checkOut.toISOString(),
                            status: 'present'
                        };
                        attendanceRecords.push(record);
                    }
                });
            }

            renderEmployees();
            populateEmployeeFilters();
            updateDashboard();
        }
    </script>
</body>
</html>